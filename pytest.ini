# Pytest Configuration
# File: pytest.ini
# Cấu hình testing framework với test directories cho từng service

[tool:pytest]
# Minimum version
minversion = 7.0

# Test directories cho từng microservice
testpaths =
    services/user-service/tests
    services/payment-service/tests
    services/math-solver-service/tests
    services/content-service/tests
    services/admin-service/tests
    tests

# Python files pattern
python_files =
    test_*.py
    *_test.py
    tests.py

# Python classes pattern
python_classes =
    Test*
    *Test
    *Tests

# Python functions pattern
python_functions =
    test_*
    *_test

# Add options
addopts =
    -ra
    --strict-markers
    --strict-config
    --cov=services
    --cov-report=term-missing
    --cov-report=html:htmlcov
    --cov-report=xml:coverage.xml
    --cov-fail-under=80
    --tb=short
    --durations=10
    -v

# Test markers cho từng service và loại test
markers =
    # Service-specific markers
    user_service: marks tests for user service
    payment_service: marks tests for payment service
    math_solver_service: marks tests for math solver service
    content_service: marks tests for content service
    admin_service: marks tests for admin service

    # Test type markers
    unit: marks tests as unit tests
    integration: marks tests as integration tests
    api: marks tests as API tests
    database: marks tests that require database
    redis: marks tests that require Redis

    # Performance markers
    slow: marks tests as slow (deselect with '-m "not slow"')
    fast: marks tests as fast

    # Authentication markers
    auth: marks tests related to authentication
    no_auth: marks tests that don't require authentication

    # Payment markers
    payment: marks tests related to payment processing

    # Math solver markers
    math: marks tests related to math solving

# Asyncio mode
asyncio_mode = auto

# Filter warnings
filterwarnings =
    error
    ignore::UserWarning
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore:.*unclosed.*:ResourceWarning

# Log settings
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# Test discovery
norecursedirs =
    .git
    .tox
    dist
    build
    south_migrations
    .venv
    venv
    node_modules
    migrations

# Timeout for tests (seconds)
timeout = 300

# =============================================================================
# COVERAGE CONFIGURATION
# =============================================================================

# Coverage source directories
# (Cấu hình này sẽ được sử dụng bởi pytest-cov)

# Directories to include in coverage
# services/user-service/
# services/payment-service/
# services/math-solver-service/
# services/content-service/
# services/admin-service/

# Files to omit from coverage
# */tests/*
# */test_*.py
# */*_test.py
# */conftest.py
# */migrations/*
